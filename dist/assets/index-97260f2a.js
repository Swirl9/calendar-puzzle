var B=Object.defineProperty;var N=(o,t,e)=>t in o?B(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var h=(o,t,e)=>(N(o,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();class v{constructor(t,e,i,s,n,r){h(this,"element");h(this,"order",0);this.north=t,this.east=e,this.south=i,this.west=s,this.name=n,this.order=r||0}getName(){return this.name}setOrder(t){this.order=t}getOrder(){return this.order}render(){let t=document.createElement("div");return t.innerText=this.getName()||"",t.classList.add("square"),this.sideIsEmpty(this.north)&&(t.classList.add("top-border"),this.sideIsEmpty(this.east)&&t.classList.add("top-right-radius")),this.sideIsEmpty(this.east)&&(t.classList.add("right-border"),this.sideIsEmpty(this.south)&&t.classList.add("bottom-right-radius")),this.sideIsEmpty(this.south)&&(t.classList.add("bottom-border"),this.sideIsEmpty(this.west)&&t.classList.add("bottom-left-radius")),this.sideIsEmpty(this.west)&&(t.classList.add("left-border"),this.sideIsEmpty(this.north)&&t.classList.add("top-left-radius")),t.style.order=this.getOrder().toString(),t}renderInto(t){let e=this.render();this.element=t.appendChild(e)}rotateRight(){const t=this.north;this.north=this.west,this.west=this.south,this.south=this.east,this.east=t}rotate180(){let t=this.north;this.north=this.south,this.south=t,t=this.west,this.west=this.east,this.east=t}rotateLeft(){let t=this.north;this.north=this.east,this.east=this.south,this.south=this.west,this.west=t}flip(){let t=this.east;this.east=this.west,this.west=t}sideIsEmpty(t){return t instanceof p||!t}}class p extends v{render(){let t=super.render();return t.className="square",t.classList.add("empty"),this.sideIsEmpty(this.north)&&this.sideIsEmpty(this.east)&&t.classList.add("top-right-radius"),this.sideIsEmpty(this.east)&&this.sideIsEmpty(this.south)&&t.classList.add("bottom-right-radius"),this.sideIsEmpty(this.south)&&this.sideIsEmpty(this.west)&&t.classList.add("bottom-left-radius"),this.sideIsEmpty(this.west)&&this.sideIsEmpty(this.north)&&t.classList.add("top-left-radius"),t}sideIsEmpty(t){return!(t instanceof p)&&!!t}}class w{constructor(){h(this,"north");h(this,"east");h(this,"south");h(this,"west");h(this,"name");h(this,"order",0)}build(){return new v(this.north,this.east,this.south,this.west,this.name,this.order)}buildEmpty(){return new p(this.north,this.east,this.south,this.west,this.name,this.order)}setOrder(t){return this.order=t||0,this}setNorth(t){return this.north=t,this}setEast(t){return this.east=t,this}setSouth(t){return this.south=t,this}setWest(t){return this.west=t,this}setName(t){return this.name=t,this}}class I{constructor(t,e){h(this,"squares");h(this,"name");h(this,"element");h(this,"size",50);h(this,"orientation","original");this.name=e,this.squares=this.createShape(t),this.reorder()}getName(){return this.name}render(t={x:200,y:200}){let e=document.createElement("div");return e.id=this.name,e.style.left=`${t.x}px`,e.style.top=`${t.y}px`,e.classList.add("piece"),this.orientation==="original"?(e.style.height=`${this.squares.length*this.size}px`,e.style.width=`${this.squares[0].length*this.size}px`):(e.style.height=`${this.squares[0].length*this.size}px`,e.style.width=`${this.squares.length*this.size}px`),this.flattenSquares().forEach(i=>i.renderInto(e)),e}renderInto(t){let e;if(this.element){let s=this.element.getBoundingClientRect();e={x:s.left,y:s.top}}else e={x:0,y:0};let i=this.render(e);this.element&&this.element.remove(),this.element=t.appendChild(i)}rotateRight(){this.flattenSquares().forEach(t=>t.rotateRight()),this.orientation==="original"?this.orientation="90deg":this.orientation="original",this.reorder(),this.element&&this.element.parentElement&&this.renderInto(this.element.parentElement)}rotateLeft(){this.flattenSquares().forEach(t=>t.rotateLeft()),this.orientation==="original"?this.orientation="90deg":this.orientation="original",this.reorder(),this.element&&this.element.parentElement&&this.renderInto(this.element.parentElement)}rotate180(){this.flattenSquares().forEach(t=>t.rotate180()),this.reorder(),this.element&&this.element.parentElement&&this.renderInto(this.element.parentElement)}flip(){this.flattenSquares().forEach(t=>t.flip()),this.reorder(),this.element&&this.element.parentElement&&this.renderInto(this.element.parentElement)}reorder(){function t(s){return s.west?t(s.west):s.north?t(s.north):s}let e=0;function i(s,n){s.setOrder(e),++e,s.east&&i(s.east,!1),s.south&&n&&i(s.south,!0)}i(t(this.squares[0][0]),!0)}createShape(t){let e;if(t.find(s=>(!e&&e!==0&&(e=s.length),s.length!==e)))return console.error("Pattern rows length mismatch"),t.forEach(s=>console.error(...s)),[];let i=[];for(;i.length<t.length;)i.push(Array(t[0].length));for(let s=0;s<t.length;++s)for(let n=0;n<t[s].length;++n){let r=t[s][n];r||r===""?i[s][n]=new w().setName(r).build():i[s][n]=new w().buildEmpty()}for(let s=0;s<i.length;++s)for(let n=0;n<i[s].length;++n){let r=i[s][n];s>0&&(r.north=i[s-1][n]),s<i.length-1&&(r.south=i[s+1][n]),n>0&&(r.west=i[s][n-1]),n<i[s].length-1&&(r.east=i[s][n+1])}return i}flattenSquares(){return this.squares.flat()}}class d extends I{constructor(){super(...arguments);h(this,"ghost");h(this,"moving",!1);h(this,"currentX",0);h(this,"currentY",0);h(this,"initialX",0);h(this,"initialY",0)}renderInto(e){super.renderInto(e),this.element,this.flattenSquares().forEach(i=>{i.element&&(i instanceof p?i.element.addEventListener("mousedown",this.propagateUnder.bind(this)):(i.element.addEventListener("mousedown",this.start.bind(this)),i.element.addEventListener("mousemove",this.move.bind(this)),i.element.addEventListener("mouseup",this.end.bind(this))))})}propagateUnder(e){let i=document.elementsFromPoint(e.clientX,e.clientY);for(;i.length;){let s=i.pop();if(s){if(s.classList.contains("empty"))continue;if(s.classList.contains("square")&&s!==e.target){let n=new MouseEvent(e.type,e);s.dispatchEvent(n);break}}}}rotate180(){this.moving||super.rotate180()}rotateLeft(){this.moving||super.rotateLeft()}rotateRight(){this.moving||super.rotateRight()}flip(){this.moving||super.flip()}reset(){this.currentX=0,this.currentY=0,this.initialX=0,this.initialY=0,this.ghost&&this.ghost.remove(),this.ghost=void 0}start(e){if(!this.element)return;this.element&&!this.moving&&dispatchEvent(new CustomEvent("moved",{detail:{target:this}})),this.initialX=e.clientX,this.initialY=e.clientY,this.getBoardSquare(e.clientX,e.clientY)&&(this.ghost=this.createGhost());let i=this.element.parentElement;i==null||i.append(this.element),this.moving=!0}end(){if(!this.moving||!this.element)return;this.initialX=this.currentX,this.initialY=this.currentY;let e;this.ghost?e=this.ghost.getBoundingClientRect():e=this.element.getBoundingClientRect(),this.element.style.removeProperty("zIndex"),this.element.style.left=`${e.left}px`,this.element.style.top=`${e.top}px`,this.element.style.removeProperty("transform"),this.moving=!1,this.reset()}getBoardSquare(e,i){return document.elementsFromPoint(e,i).find(n=>{var r;return!n.classList.contains("empty")&&n.classList.contains("square")&&((r=n.parentElement)==null?void 0:r.id)==="board"})}snapGhostToGrid(e){var s,n;let i=this.getBoardSquare(e.clientX,e.clientY);if(i||(this.ghost&&this.ghost.remove(),this.ghost=void 0),!this.ghost&&i&&(this.ghost=this.createGhost(),this.ghost&&(this.ghost.style.top=`${e.clientY-this.initialY}px`,this.ghost.style.left=`${e.clientX-this.initialX}px`,this.ghost.style.removeProperty("transform"),(n=(s=this.element)==null?void 0:s.parentElement)==null||n.append(this.element))),i&&this.ghost){let r=e.target,f=Array.from(this.ghost.children).find(a=>a.style.order===r.style.order.toString());if(f){let a=this.ghost.getBoundingClientRect(),m=f.getBoundingClientRect(),u=i.getBoundingClientRect(),q=u.x-m.x,$=u.y-m.y;this.ghost.style.left=`${a.x+q}px`,this.ghost.style.top=`${a.y+$}px`}}}move(e){this.element&&this.moving&&(e.preventDefault(),this.snapGhostToGrid(e),this.currentX=e.clientX-this.initialX,this.currentY=e.clientY-this.initialY,this.element.style.transform=`translate3d(${this.currentX}px, ${this.currentY}px, 0)`)}createGhost(){var i;if(!this.element)return;let e=this.element.cloneNode(!0);return e.style.opacity="0.5",e.id+="_ghost",e.style.zIndex=(Number(e.style.zIndex)-1).toString(),(i=this.element.parentElement)==null?void 0:i.appendChild(e)}}const L=new d([["","",""],["","",""]],"rectangle"),b=new d([["",0,""],["","",""]],"tunnel"),x=new d([["","","",""],[0,0,"",0]],"baton"),S=new d([[0,"","",""],["","",0,0]],"crowbar"),P=new d([["","","",""],[0,0,0,""]],"L"),R=new d([["","",""],["",0,0],["",0,0]],"corner"),X=new d([[0,0,""],["","",""],["",0,0]],"S"),Y=new d([[0,""],["",""],["",""]],"thumb"),y=new I([["Jan","Feb","Mar","Apr","May","Jun",0],["Jul","Aug","Sep","Oct","Nov","Dec",0],["1","2","3","4","5","6","7"],["8","9","10","11","12","13","14"],["15","16","17","18","19","20","21"],["22","23","24","25","26","27","28"],["29","30","31",0,0,0,0]],"board");let l=document.querySelector("#app");y.renderInto(l);b.renderInto(l);L.renderInto(l);x.renderInto(l);S.renderInto(l);P.renderInto(l);R.renderInto(l);X.renderInto(l);Y.renderInto(l);c(b);c(L);c(x);c(S);c(P);c(R);c(X);c(Y);let g;window.addEventListener("moved",o=>{var t;g=(t=o.detail)==null?void 0:t.target});window.addEventListener("keydown",o=>{if(g)switch(o.key){case"ArrowRight":g.rotateRight();break;case"ArrowLeft":g.rotateLeft();break;case"ArrowUp":case"ArrowDown":g.flip();break}});function c(o){if(!y.element)return;let t=y.element.getBoundingClientRect(),e=t.x+t.width/2,i=t.y+t.height/2,s=E(),n=E();if(!o.element)return;let r=o.element.getBoundingClientRect(),f=i+n,a=e+s,m,u;f<0?m=0:f>window.innerHeight-r.height?m=window.innerHeight-r.height:m=f,a<0?u=0:a>window.innerWidth-r.width?u=window.innerWidth-r.width:u=a,o.element.style.top=`${m}px`,o.element.style.left=`${u}px`}function E(){return Math.floor(Math.random()*1001)-500}

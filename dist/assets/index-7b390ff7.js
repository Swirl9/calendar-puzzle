var R=Object.defineProperty;var N=(o,e,s)=>e in o?R(o,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[e]=s;var h=(o,e,s)=>(N(o,typeof e!="symbol"?e+"":e,s),s);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))r(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function s(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(t){if(t.ep)return;t.ep=!0;const i=s(t);fetch(t.href,i)}})();class L{constructor(e,s,r,t,i,n){h(this,"element");h(this,"order",0);this.north=e,this.east=s,this.south=r,this.west=t,this.name=i,this.order=n||0}getName(){return this.name}setOrder(e){this.order=e}getOrder(){return this.order}render(){let e=document.createElement("div");return e.innerText=this.getName()||"",e.classList.add("square"),this.sideIsEmpty(this.north)&&(e.classList.add("top-border"),this.sideIsEmpty(this.east)&&e.classList.add("top-right-radius")),this.sideIsEmpty(this.east)&&(e.classList.add("right-border"),this.sideIsEmpty(this.south)&&e.classList.add("bottom-right-radius")),this.sideIsEmpty(this.south)&&(e.classList.add("bottom-border"),this.sideIsEmpty(this.west)&&e.classList.add("bottom-left-radius")),this.sideIsEmpty(this.west)&&(e.classList.add("left-border"),this.sideIsEmpty(this.north)&&e.classList.add("top-left-radius")),e.style.order=this.getOrder().toString(),e}renderInto(e){let s=this.render();this.element=e.appendChild(s)}rotateRight(){const e=this.north;this.north=this.west,this.west=this.south,this.south=this.east,this.east=e}rotateLeft(){let e=this.north;this.north=this.east,this.east=this.south,this.south=this.west,this.west=e}flipHorizontally(){let e=this.east;this.east=this.west,this.west=e}flipVertically(){let e=this.north;this.north=this.south,this.south=e}sideIsEmpty(e){return e instanceof f||!e}}class f extends L{render(){let e=super.render();return e.className="square",e.classList.add("empty"),this.sideIsEmpty(this.north)&&this.sideIsEmpty(this.east)&&e.classList.add("top-right-radius"),this.sideIsEmpty(this.east)&&this.sideIsEmpty(this.south)&&e.classList.add("bottom-right-radius"),this.sideIsEmpty(this.south)&&this.sideIsEmpty(this.west)&&e.classList.add("bottom-left-radius"),this.sideIsEmpty(this.west)&&this.sideIsEmpty(this.north)&&e.classList.add("top-left-radius"),e}sideIsEmpty(e){return!(e instanceof f)&&!!e}}class y{constructor(){h(this,"north");h(this,"east");h(this,"south");h(this,"west");h(this,"name");h(this,"order",0)}build(){return new L(this.north,this.east,this.south,this.west,this.name,this.order)}buildEmpty(){return new f(this.north,this.east,this.south,this.west,this.name,this.order)}setOrder(e){return this.order=e||0,this}setNorth(e){return this.north=e,this}setEast(e){return this.east=e,this}setSouth(e){return this.south=e,this}setWest(e){return this.west=e,this}setName(e){return this.name=e,this}}class I{constructor(e,s){h(this,"squares");h(this,"name");h(this,"element");h(this,"size",50);h(this,"orientation","original");this.name=s,this.squares=this.createShape(e),this.reorder()}getName(){return this.name}render(e={x:200,y:200}){let s=document.createElement("div");return s.id=this.name,s.style.left=`${e.x}px`,s.style.top=`${e.y}px`,s.classList.add("piece"),this.orientation==="original"?(s.style.height=`${this.squares.length*this.size}px`,s.style.width=`${this.squares[0].length*this.size}px`):(s.style.height=`${this.squares[0].length*this.size}px`,s.style.width=`${this.squares.length*this.size}px`),this.flattenSquares().forEach(r=>r.renderInto(s)),s}renderInto(e){let s;if(this.element){let t=this.element.getBoundingClientRect();s={x:t.left,y:t.top}}else s={x:0,y:0};let r=this.render(s);this.element&&this.element.remove(),this.element=e.appendChild(r)}rotateRight(){this.flattenSquares().forEach(e=>e.rotateRight()),this.orientation==="original"?this.orientation="90deg":this.orientation="original",this.reorder(),this.element&&this.element.parentElement&&this.renderInto(this.element.parentElement)}rotateLeft(){this.flattenSquares().forEach(e=>e.rotateLeft()),this.orientation==="original"?this.orientation="90deg":this.orientation="original",this.reorder(),this.element&&this.element.parentElement&&this.renderInto(this.element.parentElement)}flipHorizontally(){this.flattenSquares().forEach(e=>e.flipHorizontally()),this.reorder(),this.element&&this.element.parentElement&&this.renderInto(this.element.parentElement)}flipVertically(){this.flattenSquares().forEach(e=>e.flipVertically()),this.reorder(),this.element&&this.element.parentElement&&this.renderInto(this.element.parentElement)}reorder(){function e(t){return t.west?e(t.west):t.north?e(t.north):t}let s=0;function r(t,i){t.setOrder(s),++s,t.east&&r(t.east,!1),t.south&&i&&r(t.south,!0)}r(e(this.squares[0][0]),!0)}createShape(e){let s;if(e.find(t=>(!s&&s!==0&&(s=t.length),t.length!==s)))return console.error("Pattern rows length mismatch"),e.forEach(t=>console.error(...t)),[];let r=[];for(;r.length<e.length;)r.push(Array(e[0].length));for(let t=0;t<e.length;++t)for(let i=0;i<e[t].length;++i){let n=e[t][i];n||n===""?r[t][i]=new y().setName(n).build():r[t][i]=new y().buildEmpty()}for(let t=0;t<r.length;++t)for(let i=0;i<r[t].length;++i){let n=r[t][i];t>0&&(n.north=r[t-1][i]),t<r.length-1&&(n.south=r[t+1][i]),i>0&&(n.west=r[t][i-1]),i<r[t].length-1&&(n.east=r[t][i+1])}return r}flattenSquares(){return this.squares.flat()}}class d extends I{constructor(s,r){super(s,r);h(this,"moving",!1)}render(s){let r=super.render(s);return r.addEventListener("mousedown",this.onmousedown.bind(this)),r.addEventListener("mouseup",this.onmouseup.bind(this)),r}onmousedown(s){if(s.target.classList.contains("empty")){let i=document.elementsFromPoint(s.x,s.y).find(n=>n.classList.contains("square"));if(i){let n=new MouseEvent(s.type,s);i.dispatchEvent(n)}}else if(this.element){let t=this.element.parentElement;t==null||t.append(this.element),this.moving=!0,dispatchEvent(new CustomEvent("puzzle-piece-select",{detail:{target:this}}))}}onmouseup(){this.moving=!1,dispatchEvent(new CustomEvent("puzzle-piece-unselect",{detail:{target:this}}))}}const b=new d([["","",""],["","",""]],"rectangle"),v=new d([["",0,""],["","",""]],"tunnel"),P=new d([["","","",""],[0,0,"",0]],"baton"),x=new d([[0,"","",""],["","",0,0]],"crowbar"),z=new d([["","","",""],[0,0,0,""]],"L"),S=new d([["","",""],["",0,0],["",0,0]],"corner"),q=new d([[0,0,""],["","",""],["",0,0]],"S"),O=new d([[0,""],["",""],["",""]],"thumb"),w=new I([["Jan","Feb","Mar","Apr","May","Jun",0],["Jul","Aug","Sep","Oct","Nov","Dec",0],["1","2","3","4","5","6","7"],["8","9","10","11","12","13","14"],["15","16","17","18","19","20","21"],["22","23","24","25","26","27","28"],["29","30","31",0,0,0,0]],"board");let a=document.querySelector("#app");w.renderInto(a);v.renderInto(a);b.renderInto(a);P.renderInto(a);x.renderInto(a);z.renderInto(a);S.renderInto(a);q.renderInto(a);O.renderInto(a);c(v);c(b);c(P);c(x);c(z);c(S);c(q);c(O);let l;a.addEventListener("mousemove",o=>{if(l&&l.element){let e=l.element,s=e.getBoundingClientRect(),r=s.width,t=s.height,i={x:Math.floor(o.x-r/2),y:Math.floor(o.y-t/2)};e.style.left=`${i.x}px`,e.style.top=`${i.y}px`}});window.addEventListener("puzzle-piece-select",o=>{var e;l=(e=o.detail)==null?void 0:e.target});window.addEventListener("puzzle-piece-unselect",()=>{l=void 0});window.addEventListener("keydown",o=>{if(l)switch(o.key){case"ArrowDown":l.rotateRight();break;case"ArrowLeft":l.rotateLeft();break;case"ArrowUp":l.flipVertically();break;case"ArrowRight":l.flipHorizontally();break}});function c(o){if(!w.element)return;let e=w.element.getBoundingClientRect(),s=e.x+e.width/2,r=e.y+e.height/2,t=E(),i=E();if(!o.element)return;let n=o.element.getBoundingClientRect(),p=r+i,g=s+t,u,m;p<0?u=0:p>window.innerHeight-n.height?u=window.innerHeight-n.height:u=p,g<0?m=0:g>window.innerWidth-n.width?m=window.innerWidth-n.width:m=g,o.element.style.top=`${u}px`,o.element.style.left=`${m}px`}function E(){return Math.floor(Math.random()*1001)-500}
